---
sidebar: sidebar 
permalink: task_config_telegraf_agent.html 
keywords: telegraf, agent, telegraf agent 
summary: Data Infrastructure Insights は、統合データの収集エージェントとして Telegraf をサポートしており、Windows または Linux で構成できます。 
---
= データ収集のためのエージェントの構成 (Windows/Linux)
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Data Infrastructure Insightsサイトはlink:https://docs.influxdata.com/telegraf["テレグラフ"]統合データの収集エージェントとして。Telegraf は、メトリック、イベント、ログを収集およびレポートするために使用できるプラグイン駆動型のサーバー エージェントです。入力プラグインは、システム/OS に直接アクセスしたり、サードパーティの API を呼び出したり、構成されたストリーム (Kafka、statsD など) をリッスンしたりして、エージェントに必要な情報を収集するために使用されます。出力プラグインは、収集されたメトリック、イベント、およびログをエージェントからData Infrastructure Insightsに送信するために使用されます。

Kubernetesへのインストールについては、link:task_config_telegraf_agent_k8s.html["NetApp Kubernetes 監視オペレーター"]ページ。


NOTE: 正確な監査とデータ レポートのために、*ネットワーク タイム プロトコル (NTP)* または *簡易ネットワーク タイム プロトコル (SNTP)* を使用してエージェント マシンの時刻を同期することを強くお勧めします。


NOTE: エージェントをインストールする前にインストールファイルを検証したい場合は、以下のセクションを参照してください。<<Telegraf パッケージのチェックサムの検証>> 。



== エージェントのインストール

サービス データ コレクターをインストールしていて、まだエージェントを構成していない場合は、まず適切なオペレーティング システム用のエージェントをインストールするように求められます。このトピックでは、次のオペレーティング システムに Telegraf エージェントをインストールする手順について説明します。

* <<Windows>>
* <<RHEL と CentOS>>
* <<UbuntuとDebian>>


エージェントをインストールするには、使用しているプラットフォームに関係なく、まず次の手順を実行する必要があります。

. エージェントに使用するホストにログインします。
. Data Infrastructure Insights環境にログインし、*Observability > Collectors* に移動します。
. *+データコレクター*をクリックし、インストールするデータコレクターを選択します。
. ホストに適したプラットフォームを選択します（Windows、Linux）
. 各プラットフォームの残りの手順に従います。



NOTE: 一度ホストにエージェントをインストールすると、そのホストに再度エージェントをインストールする必要はありません。


TIP: サーバー/VM にエージェントをインストールすると、 Data Infrastructure Insights は、構成したデータ コレクターからの収集に加えて、そのシステムからメトリックを収集します。これらの指標は次のように収集されますlink:task_config_telegraf_node.html["「ノード」メトリック"]。


NOTE: プロキシを使用している場合は、Telegraf エージェントをインストールする前に、プラットフォームのプロキシ手順をお読みください。



=== ログの場所

デフォルトでは、Telegraf ログ メッセージは stdout から次のログ ファイルにリダイレクトされます。

* RHEL/CentOS: /var/log/telegraf/telegraf.log
* Ubuntu/Debian: /var/log/telegraf/telegraf.log
* Windows: C:\Program Files\telegraf\telegraf.log




=== Windows



==== 前提条件

* PowerShellがインストールされている必要があります
* プロキシを使用している場合は、「*Windows のプロキシ サポートの構成*」セクションの指示に従う必要があります。




==== Windows のプロキシサポートの構成


NOTE: 環境でプロキシを使用している場合は、インストールする前にこのセクションをお読みください。


NOTE: 以下の手順は、_http_proxy/https_proxy_ 環境変数を設定するために必要なアクションの概要を示しています。一部のプロキシ環境では、ユーザーは _no_proxy environment_ 変数も設定する必要があります。

プロキシの背後にあるシステムの場合は、Telegraf エージェントをインストールする前に、次の操作を実行して _https_proxy_ および/または _http_proxy_ 環境変数を設定します。

 [System.Environment]:SetEnvironmentVariable(“https_proxy”, “<proxy_server>:<proxy_port>”, [System.EnvironmentVariableTarget]:Machine)


==== エージェントのインストール

image:AgentInstallWindows.png["Windowsエージェントのインストール"]

.Windows にエージェントをインストールする手順:
. エージェント アクセス キーを選択します。
. エージェントのインストール ダイアログからコマンド ブロックをコピーします。クリップボード アイコンをクリックすると、コマンドをクリップボードにすばやくコピーできます。
. PowerShellウィンドウを開く
. コマンドを PowerShell ウィンドウに貼り付けて Enter キーを押します。
. このコマンドは適切なエージェント インストーラーをダウンロードしてインストールし、デフォルト構成を設定します。完了すると、エージェント サービスが再起動されます。コマンドには一意のキーがあり、24 時間有効です。
. *完了*または*続行*をクリックします


エージェントをインストールした後、次のコマンドを使用してサービスを開始/停止できます。

....
Start-Service telegraf
Stop-Service telegraf
....


==== エージェントのアンインストール

Windows でエージェントをアンインストールするには、PowerShell ウィンドウで次の操作を行います。

. Telegraf サービスを停止して削除します。
+
....
Stop-Service telegraf
sc.exe delete telegraf
....
. トラストストアから証明書を削除します。
+
....
cd Cert:\CurrentUser\Root
//rm E5FB7B68C08B1CA902708584C274F8EFC7BE8ABC
rm 1A918038E8E127BB5C87A202DF173B97A05B4996
....
. _C:\Program Files\telegraf_ フォルダを削除して、バイナリ、ログ、および構成ファイルを削除します。
. レジストリから_SYSTEM\CurrentControlSet\Services\EventLog\Application\telegraf_キーを削除します。




==== エージェントのアップグレード

Telegraf エージェントをアップグレードするには、次の手順を実行します。

. Telegraf サービスを停止して削除します。
+
....
Stop-Service telegraf
sc.exe delete telegraf
....
. レジストリから_SYSTEM\CurrentControlSet\Services\EventLog\Application\telegraf_キーを削除します。
. _C:\Program Files\telegraf\telegraf.conf_ を削除します。
. _C:\Program Files\telegraf\telegraf.exe_ を削除します。
. link:#windows["新しいエージェントをインストールする"] 。




=== RHEL と CentOS



==== 前提条件

* 次のコマンドが利用可能である必要があります: curl、sudo、ping、sha256sum、openssl、および dmidecode
* プロキシを使用している場合は、*RHEL/CentOS のプロキシ サポートの構成*セクションの指示に従う必要があります。




==== RHEL/CentOS のプロキシサポートの設定


NOTE: 環境でプロキシを使用している場合は、インストールする前にこのセクションをお読みください。


NOTE: 以下の手順は、_http_proxy/https_proxy_ 環境変数を設定するために必要なアクションの概要を示しています。一部のプロキシ環境では、ユーザーは _no_proxy environment_ 変数も設定する必要があります。

プロキシの背後にあるシステムの場合は、Telegraf エージェントをインストールする前に、次の手順を実行します。

. 現在のユーザーの _https_proxy_ および/または _http_proxy_ 環境変数を設定します。
+
 export https_proxy=<proxy_server>:<proxy_port>
. _/etc/default/telegraf_ を作成し、_https_proxy_ および/または _http_proxy_ 変数の定義を挿入します。
+
 https_proxy=<proxy_server>:<proxy_port>




==== エージェントのインストール

image:Agent_Requirements_Rhel.png["Rhel/CentOS エージェントのインストール"]

.RHEL/CentOS にエージェントをインストールする手順:
. エージェント アクセス キーを選択します。
. エージェントのインストール ダイアログからコマンド ブロックをコピーします。クリップボード アイコンをクリックすると、コマンドをクリップボードにすばやくコピーできます。
. Bashウィンドウを開く
. コマンドをBash ウィンドウに貼り付けて、Enter キーを押します。
. このコマンドは適切なエージェント インストーラーをダウンロードしてインストールし、デフォルト構成を設定します。完了すると、エージェント サービスが再起動されます。コマンドには一意のキーがあり、24 時間有効です。
. *完了*または*続行*をクリックします


エージェントをインストールした後、次のコマンドを使用してサービスを開始/停止できます。

オペレーティング システムで systemd を使用している場合 (CentOS 7+ および RHEL 7+):

....
sudo systemctl start telegraf
sudo systemctl stop telegraf
....
オペレーティング システムで systemd を使用していない (CentOS 7+ および RHEL 7+) 場合:

....
sudo service telegraf start
sudo service telegraf stop
....


==== エージェントのアンインストール

RHEL/CentOS 上のエージェントをアンインストールするには、Bash ターミナルで次の手順を実行します。

. Telegraf サービスを停止します。
+
....
systemctl stop telegraf (If your operating system is using systemd (CentOS 7+ and RHEL 7+)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. Telegraf エージェントを削除します。
+
 yum remove telegraf
. 残っている可能性のある構成ファイルやログ ファイルをすべて削除します。
+
....
rm -rf /etc/telegraf*
rm -rf /var/log/telegraf*
....




==== エージェントのアップグレード

Telegraf エージェントをアップグレードするには、次の手順を実行します。

. Telegraf サービスを停止します。
+
....
systemctl stop telegraf (If your operating system is using systemd (CentOS 7+ and RHEL 7+)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. 以前の Telegraf エージェントを削除します。
+
 yum remove telegraf
. link:#rhel-and-centos["新しいエージェントをインストールする"] 。




=== UbuntuとDebian



==== 前提条件

* 次のコマンドが利用可能である必要があります: curl、sudo、ping、sha256sum、openssl、および dmidecode
* プロキシを使用している場合は、*Ubuntu/Debian のプロキシ サポートの構成* セクションの指示に従う必要があります。




==== Ubuntu/Debian のプロキシサポートの設定


NOTE: 環境でプロキシを使用している場合は、インストールする前にこのセクションをお読みください。


NOTE: 以下の手順は、_http_proxy/https_proxy_ 環境変数を設定するために必要なアクションの概要を示しています。一部のプロキシ環境では、ユーザーは _no_proxy environment_ 変数も設定する必要があります。

プロキシの背後にあるシステムの場合は、Telegraf エージェントをインストールする前に、次の手順を実行します。

. 現在のユーザーの _https_proxy_ および/または _http_proxy_ 環境変数を設定します。
+
 export https_proxy=<proxy_server>:<proxy_port>
. /etc/default/telegraf を作成し、_https_proxy_ および/または _http_proxy_ 変数の定義を挿入します。
+
 https_proxy=<proxy_server>:<proxy_port>




==== エージェントのインストール

image:Agent_Requirements_Ubuntu.png["Ubuntu/Debianエージェントのインストール"]

.Debian または Ubuntu にエージェントをインストールする手順:
. エージェント アクセス キーを選択します。
. エージェントのインストール ダイアログからコマンド ブロックをコピーします。クリップボード アイコンをクリックすると、コマンドをクリップボードにすばやくコピーできます。
. Bashウィンドウを開く
. コマンドをBash ウィンドウに貼り付けて、Enter キーを押します。
. このコマンドは適切なエージェント インストーラーをダウンロードしてインストールし、デフォルト構成を設定します。完了すると、エージェント サービスが再起動されます。コマンドには一意のキーがあり、24 時間有効です。
. *完了*または*続行*をクリックします


エージェントをインストールした後、次のコマンドを使用してサービスを開始/停止できます。

オペレーティング システムで systemd を使用している場合:

....
sudo systemctl start telegraf
sudo systemctl stop telegraf
....
オペレーティング システムで systemd を使用していない場合は、次の操作を行います。

....
sudo service telegraf start
sudo service telegraf stop
....


==== エージェントのアンインストール

Ubuntu/Debian でエージェントをアンインストールするには、Bash ターミナルで次のコマンドを実行します。

. Telegraf サービスを停止します。
+
....
systemctl stop telegraf (If your operating system is using systemd)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. Telegraf エージェントを削除します。
+
 dpkg -r telegraf
. 残っている可能性のある構成ファイルやログ ファイルをすべて削除します。
+
....
rm -rf /etc/telegraf*
rm -rf /var/log/telegraf*
....




==== エージェントのアップグレード

Telegraf エージェントをアップグレードするには、次の手順を実行します。

. Telegraf サービスを停止します。
+
....
systemctl stop telegraf (If your operating system is using systemd)
/etc/init.d/telegraf stop (for systems without systemd support)
....
. 以前の Telegraf エージェントを削除します。
+
 dpkg -r telegraf
. link:#ubuntu-and-debian["新しいエージェントをインストールする"] 。




== Telegraf パッケージのチェックサムの検証

Data Infrastructure Insightsエージェント インストーラーは整合性チェックを実行しますが、ダウンロードした Telegraf バイナリをインストールする前に独自の検証を実行することを望むユーザーもいます。これは、インストーラーをダウンロードし、ダウンロードしたパッケージのチェックサムを生成し、そのチェックサムをインストール手順に示されている値と比較することで実行できます。



=== インストールせずにインストーラーパッケージをダウンロードする

ダウンロードのみの操作 (デフォルトのダウンロードとインストールではなく) を実行するには、ユーザーは UI から取得したエージェント インストール コマンドを編集し、「インストール」オプションを削除します。

次の手順を実行します。

. 指示に従ってエージェント インストーラー スニペットをコピーします。
. スニペットをコマンド ウィンドウに貼り付ける代わりに、テキスト エディターに貼り付けます。
. コマンドの末尾の「--install」（Linux）または「-install」（Windows）を削除します。
. テキスト エディターからコマンド全体をコピーします。
. 次に、それをコマンド ウィンドウ (作業ディレクトリ内) に貼り付けて実行します。


Windows 以外 (これらの例は Kubernetes 用です。実際のスクリプト名は異なる場合があります):

* ダウンロードしてインストールする（デフォルト）:
+
 installerName=cloudinsights-ubuntu_debian.sh … && ./$installerName --download --verify && sudo -E -H ./$installerName --install
* ダウンロード専用:
+
 installerName=cloudinsights-ubuntu_debian.sh … && ./$installerName --download --verify


Windows：

* ダウンロードしてインストールする（デフォルト）:
+
 !$($installerName=".\cloudinsights-windows.ps1") … -and $(if(((Get-FileHash $installerName).Hash).ToLower() -eq "INSTALLER_CHECKSUM ") { &$installerName -download -verify -install } else { Write-Host "Install script checksum does not match"})"
* ダウンロード専用:
+
 !$($installerName=".\cloudinsights-windows.ps1") … -and $(if(((Get-FileHash $installerName).Hash).ToLower() -eq "INSTALLER_CHECKSUM ") { &$installerName -download -verify } else { Write-Host "Install script checksum does not match"})"


ダウンロード専用コマンドは、必要なすべての成果物をData Infrastructure Insightsから作業ディレクトリにダウンロードします。アーティファクトには、以下のものが含まれますが、これらに限定されるわけではありません。

* インストールスクリプト
* 環境ファイル
* Telegrafバイナリ
* Telegrafバイナリの署名
* バイナリ署名を検証するための公開証明書


DII からダウンロードしてコピーされたインストール スニペットはインストール スクリプトのチェックサムを自動的に計算し、インストール スクリプトによって telegraf バイナリの署名が検証されます。



=== チェックサム値を検証する

チェックサム値を生成するには、適切なプラットフォームに応じて次のコマンドを実行します。

* RHEL/Ubuntu:
+
 sha256sum <package_name>
* Windows：
+
 Get-FileHash telegraf.zip -Algorithm SHA256 | Format-List




=== ダウンロードしたパッケージをインストールする

すべてのアーティファクトが適切に検証されたら、次のコマンドを実行してエージェントのインストールを開始できます。

Windows以外:

 sudo -E -H ./<installation_script_name> --install
Windows：

 .\cloudinsights-windows.ps1 -install


== APIアクセストークンの作成と使用

Telegraf データ取り込み用の API アクセス トークンを作成するには、次のいずれかを実行してください。



=== データコレクターのインストールページから作成する

. 使用するプラットフォーム (Windows、Linux) の Data Collector インストール ページに移動します。
. + API アクセス トークン ボタンを使用してトークンを作成します。
. 名前を入力して「保存」をクリックします。
. ドロップダウンでトークン名が選択され、コレクターのインストール時に使用されます。




=== APIアクセストークンを手動で作成する

. [管理] > [API アクセス] に移動します。
. + API アクセス トークンをクリックします。
. 名前と、オプションで説明を入力します。
. 「このトークンはどのタイプの API を呼び出すために使用されますか?」の下で、「データ取り込み」のみを選択し、「取得ユニット」の選択を解除します。
. 「権限」の下で「読み取り/書き込み」を選択します。
. 「Kubernetes のトークンを自動的にローテーションする」の選択を解除します。


新しく作成した API アクセス トークンを使用するには、インストーラー ページの「既存の API アクセス トークンを選択するか、新しいトークンを作成する」ドロップダウンから選択します。次のプロパティを持つトークンのみが使用できることに注意してください。

* APIタイプ:「データ取り込み」のみ
* 権限: 読み取り/書き込み
* Kubernetes 自動ローテーション: オフ




== トラブルシューティング

エージェントの設定中に問題が発生した場合に試すことができるいくつかのこと:

[cols="2*"]
|===
| 問題： | これを試してください: 


| 新しいプラグインを設定して Telegraf を再起動した後、Telegraf が起動に失敗します。ログには、次のようなエラーが記録されています: "[telegraf] エージェント実行エラー: 設定ファイル /etc/telegraf/telegraf.d/cloudinsights-default.conf の読み込みエラー: プラグイン出力.http: 行 <行番号>: 設定でフィールド ["use_system_proxy"] が指定されましたが、使用されていません" | インストールされている Telegraf のバージョンが古くなっています。このページの手順に従って、適切なプラットフォームの*エージェントをアップグレード*してください。 


| 古いインストールでインストーラスクリプトを実行したところ、エージェントがデータを送信しなくなりました | Telegraf エージェントをアンインストールしてから、インストール スクリプトを再実行します。適切なプラットフォームについては、このページの *エージェントのアップグレード* の手順に従ってください。 


| Data Infrastructure Insightsを使用してエージェントをすでにインストールしました | ホスト/VM にエージェントがすでにインストールされている場合は、エージェントを再度インストールする必要はありません。この場合は、エージェントのインストール画面で適切なプラットフォームとキーを選択し、「続行」または「完了」をクリックするだけです。 


| エージェントはすでにインストールされていますが、 Data Infrastructure Insightsインストーラーを使用していません | 以前のエージェントを削除し、 Data Infrastructure Insights Agent のインストールを実行して、適切なデフォルト構成ファイル設定を確認します。完了したら、[続行] または [完了] をクリックします。 
|===
追加情報は以下からご覧いただけます。link:concept_requesting_support.html["サポート"]ページまたはlink:reference_data_collector_support_matrix.html["データコレクターサポートマトリックス"]。
