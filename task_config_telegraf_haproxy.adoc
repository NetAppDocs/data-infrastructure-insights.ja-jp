---
sidebar: sidebar 
permalink: task_config_telegraf_haproxy.html 
keywords: telegraf, installation, install, haproxy 
summary: HAProxyデータコレクターの構成 
---
= HAProxy データコレクター
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Data Infrastructure Insights は、このデータ コレクターを使用して HAProxy からメトリックを収集します。



== インストール

. *Observability > Collectors* から、*+ Data Collector* をクリックします。  HAProxyを選択します。
+
Telegraf エージェントがインストールされているオペレーティング システムまたはプラットフォームを選択します。

. 収集用のエージェントをまだインストールしていない場合、または別のオペレーティングシステムまたはプラットフォーム用のエージェントをインストールする場合は、[手順を表示] をクリックして展開します。link:task_config_telegraf_agent.html["エージェントのインストール"]説明書。
. このデータ コレクターで使用するエージェント アクセス キーを選択します。 *+ エージェント アクセス キー* ボタンをクリックすると、新しいエージェント アクセス キーを追加できます。ベスト プラクティス: データ コレクターを OS/プラットフォーム別などにグループ化する場合にのみ、異なるエージェント アクセス キーを使用します。
. 構成手順に従ってデータ コレクターを構成します。手順は、データ収集に使用しているオペレーティング システムまたはプラットフォームの種類によって異なります。


image:HAProxyDCConfigLinux.png["HAProxy設定"]



== セットアップ

Telegraf の HAProxy 用プラグインは、HAProxy Stats の有効化に依存しています。これは HAProxy に組み込まれた構成ですが、そのままでは有効になっていません。有効にすると、HAProxy はブラウザで表示したり、すべての HAProxy 構成のステータスを抽出するためにスクレイピングしたりできる HTML エンドポイントを公開します。



=== 互換性:

構成は HAProxy バージョン 1.9.4 に対して開発されました。



=== セットアップ:

統計を有効にするには、haproxy 構成ファイルを編集し、独自のユーザー名/パスワードおよび/または haproxy URL を使用して、 'defaults' セクションの後に次の行を追加します。

[listing]
----
stats enable
stats auth myuser:mypassword
stats uri  /haproxy?stats
----
以下は、統計が有効になっている簡略化された構成ファイルの例です。

[listing]
----
global
  daemon
  maxconn 256

defaults
  mode http
  stats enable
  stats uri /haproxy?stats
  stats auth myuser:mypassword
  timeout connect 5000ms
  timeout client 50000ms
  timeout server 50000ms

frontend http-in
  bind *:80
  default_backend servers

frontend http-in9080
  bind *:9080
  default_backend servers_2

backend servers
  server server1 10.128.0.55:8080 check ssl verify none
  server server2 10.128.0.56:8080 check ssl verify none

backend servers_2
  server server3 10.128.0.57:8080 check ssl verify none
  server server4 10.128.0.58:8080 check ssl verify none
----
完全かつ最新の手順については、link:https://cbonte.github.io/haproxy-dconv/1.8/configuration.html#4-stats%20enable["HAProxyドキュメント"] 。



== オブジェクトとカウンター

次のオブジェクトとそのカウンターが収集されます。

[cols="<.<,<.<,<.<,<.<"]
|===
| オブジェクト | 識別子: | 属性: | データポイント: 


| HAProxy フロントエンド | 名前空間アドレスプロキシ | ノードIP ノード名 プロキシID モード プロセスID セッション レート制限 サーバーID セッション制限 ステータス | 受信バイト数 送信バイト数 キャッシュヒット数 キャッシュルックアップ数 圧縮バイト数 バイパス圧縮バイト数 受信バイト数 圧縮バイト数 出力バイト数 圧縮レスポンス数 接続率 接続率 最大接続数 合計リクエスト数 接続ルールにより拒否されたリクエスト数 セキュリティ上の懸念により拒否されたリクエスト数 セキュリティ上の懸念により拒否されたレスポンス数 セッションルールにより拒否されたリクエスト数 エラーレスポンス数 1xxレスポンス数 2xxレスポンス数 3xxレスポンス数 4xxレスポンス数 5xxレスポンス数 その他のリクエスト数 インターセプトされたリクエスト数 セッション率 セッション率 最大リクエスト数 リクエスト率 最大リクエスト数 合計セッション数 セッション数 最大セッション数 合計リクエスト数 書き換え 


| HAProxyサーバー | 名前空間アドレスプロキシサーバー | ノードIP ノード名 チェック完了時間 チェック下降構成チェック ヘルス値チェック上昇構成チェック ステータス プロキシID 最終変更時間 最終セッション時間 モード プロセスID サーバーID ステータス 重み | アクティブサーバー バックアップサーバー 受信バイト数 送信バイト数 チェックダウン数 チェック失敗数 クライアントの中止 接続数 接続平均時間 ダウンタイム 合計拒否数 応答数 接続エラー数 応答エラー数 応答数 1xx 応答数 2xx 応答数 3xx 応答数 4xx 応答数 5xx 応答数 選択されたその他のサーバー 合計キュー数 現在のキュー数 最大キュー数 平均時間 1秒あたりのセッション数 1秒あたりの最大セッション数 接続再利用数 応答時間 平均セッション数 最大セッション数 サーバー転送中止数 セッション数 合計セッション数 合計時間 平均リクエスト数 再ディスパッチ数 リクエスト数 再試行数 リクエスト数 書き換え数 


| HAProxyバックエンド | 名前空間アドレスプロキシ | ノードIP ノード名 プロキシID 最終変更時刻 最終セッション時刻 モード プロセスID サーバーID セッション制限 ステータス 重み | アクティブサーバー バックアップサーバー 受信バイト数 送信バイト数 キャッシュヒット数 キャッシュ検索数 チェックダウン数 クライアントによる圧縮中止数 圧縮バイパス数 圧縮受信バイト数 圧縮送信バイト数 圧縮レスポンス数 接続数 接続平均時間 ダウンタイム合計 セキュリティ上の懸念により拒否されたリクエスト数 セキュリティ上の懸念により拒否されたレスポンス数 接続エラー数 レスポンスエラー数 レスポンス数 1xxレスポンス数 2xxレスポンス数 3xxレスポンス数 4xxレスポンス数 5xxレスポンス数 選択されたその他のサーバー キュー合計数 現在のキュー数 最大キュー数 平均時間 1秒あたりのセッション数 1秒あたりのセッション数 最大リクエスト数 合計接続再利用数 レスポンス時間 平均セッション数 最大セッション数 サーバー転送中止数 セッション数 合計セッション数 合計時間 平均リクエスト数 再ディスパッチ数 リクエスト数 再試行数 リクエスト数 書き換え数 
|===


== トラブルシューティング

追加情報は以下からご覧いただけます。link:concept_requesting_support.html["サポート"]ページ。
