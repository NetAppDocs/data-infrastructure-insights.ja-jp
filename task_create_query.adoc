---
sidebar: sidebar 
permalink: task_create_query.html 
summary: クエリを使用すると、関心のある資産とメトリックをすばやく簡単に特定できます。 
keywords: query, queries 
---
= クエリの作成
:hardbreaks:
:allow-uri-read: 


[role="lead"]
クエリを使用すると、テナント上のアセットを詳細なレベルで検索できるため、必要なデータをフィルタリングし、結果を好みに合わせて並べ替えることができます。

たとえば、ボリュームのクエリを作成し、選択したボリュームに関連付けられた特定のストレージを検索するフィルターを追加し、選択したストレージの「Tier 1」などの特定の注釈を検索する別のフィルターを追加し、最後に IOPS - 読み取り (IO/s) が 25 を超えるすべてのストレージを検索する別のフィルターを追加できます。結果が表示されたら、クエリに関連付けられた情報の列を昇順または降順で並べ替えることができます。

注: アセットを取得する新しいデータ コレクターが追加されたり、注釈やアプリケーションの割り当てが行われたりした場合は、クエリがインデックス化された後でのみ、それらの新しいアセット、注釈、またはアプリケーションをクエリできます。インデックス作成は、定期的にスケジュールされた間隔で、または注釈ルールの実行などの特定のイベント中に実行されます。

.クエリの作成は非常に簡単です。
. *クエリ > *+新しいクエリ* に移動します。
. 「選択...」リストから、クエリを実行するオブジェクト タイプを選択します。リストをスクロールするか、入力を開始して検索対象をより速く見つけることができます。


.スクロールリスト:
image:QueryDrop-DownList.png["クエリドロップダウン"]

.入力して検索:
image:QueryPageFilter.png["入力して検索"]

*[フィルター条件]* フィールドの *+* ボタンをクリックすると、フィルターを追加してクエリをさらに絞り込むことができます。オブジェクトまたは属性ごとに行をグループ化します。統合データ (Kubernetes、 ONTAP高度なメトリックなど) を操作する場合、必要に応じて複数の属性でグループ化できます。

image:QueryFilterExample.png["クエリのフィルタリングとグループ化"]

クエリ結果リストには、検索したオブジェクトの種類に応じて、いくつかのデフォルトの列が表示されます。列を追加、削除、または変更するには、表の右側にある歯車アイコンをクリックします。利用可能な列は、アセット/メトリックの種類によって異なります。

image:QuerySelectColumns.png["列を選択"]



== 実際に動作を見てみましょう

link:https://media.netapp.com/video-detail/d0530e0b-a222-52e7-92b1-dbeeee41b712/explore-and-analyze-with-queries-in-data-infrastructure-insights["Data Infrastructure Insightsのクエリを使用して探索および分析する (ビデオ)"]



== 集計、単位、条件付き書式の選択



=== 集計と単位

「値」列の場合、表示される値の集計方法と値の表示単位を選択することにより、クエリ結果をさらに絞り込むことができます。これらのオプションは、列の上隅にある「3 つのドット」メニューを選択すると見つかります。

image:Query_Page_Aggregation_etc.png["集計、条件付き書式、単位表示、列名の変更を示すクエリページの結果"]



==== 単位

値を表示する単位を選択できます。たとえば、選択した列に生の容量が表示され、値が GiB で表示されているが、TiB で表示したい場合は、[単位表示] ドロップダウンから TiB を選択するだけです。



==== 集約

同様に、表示される値が基になるデータから「平均」として集計されているが、すべての値の合計を表示する場合は、[グループ化基準] ドロップダウン (グループ化された値の合計を表示する場合) または [時間集計基準] ドロップダウン (行の値に基になるデータの合計を表示する場合) から「合計」を選択します。

グループ化されたデータ ポイントを _平均、最大、最小、または合計_ で集計することを選択できます。

個々の行データは、_平均、最後に取得したデータ ポイント、最大値、最小値、または合計_ で集計できます。



==== 条件付き書式

条件付き書式を使用すると、クエリ結果リストで警告レベルと重大レベルのしきい値を強調表示できるため、外れ値や例外的なデータ ポイントを即座に確認できます。

image:Query_Page_Conditional_Formatting.png["クエリページの条件付き書式"]

条件付き書式は列ごとに個別に設定します。たとえば、容量列に 1 セットのしきい値を選択し、スループット列に別のセットのしきい値を選択できます。



==== 列の名前を変更

列の名前を変更すると、クエリ結果リストに表示される名前が変更されます。クエリ リストを .CSV にエクスポートすると、結果のファイルに新しい列名も表示されます。



=== 保存

必要な結果を表示するようにクエリを設定したら、[*保存*] ボタンをクリックして、将来使用するためにクエリを保存できます。意味のある一意の名前を付けます。



== フィルタリングの詳細



=== ワイルドカードと式

クエリまたはダッシュボード ウィジェットでテキストまたはリストの値をフィルター処理する場合、入力を開始すると、現在のテキストに基づいて *ワイルドカード フィルター* を作成するオプションが表示されます。このオプションを選択すると、ワイルドカード式に一致するすべての結果が返されます。  NOT または OR を使用して *式* を作成したり、「なし」オプションを選択してフィールド内の null 値をフィルター処理したりすることもできます。

image:Type-Ahead-Example-ingest.png["ワイルドカードフィルター"]

ワイルドカードまたは式 (例: NOT、OR、「なし」など) に基づくフィルターは、フィルター フィールドに濃い青色で表示されます。リストから直接選択した項目は水色で表示されます。

image:Type-Ahead-Example-Wildcard-DirectSelect.png["ワイルドカードフィルターの結果"]

ワイルドカードと式のフィルタリングはテキストまたはリストでは機能しますが、数値、日付、ブール値では機能しないことに注意してください。



=== フィルターの調整

フィルターを絞り込むには、次のものを使用できます。

|===


| フィルタ | 何をするのか | 例 | 結果 


| *（アスタリスク） | あらゆるものを検索できます | ヴォル*レル | 「vol」で始まり「rhel」で終わるすべてのリソースを返します。 


| ? （疑問符） | 特定の文字数を検索できます | BOS-PRD??-S12 | BOS-PRD**__12__**-S12、BOS-PRD**__23__**-S12などを返します。 


| または | 複数のエンティティを指定できる | FAS2240 または CX600 または FAS3270 | FAS2440、CX600、またはFAS3270のいずれかを返します 


| ない | 検索結果からテキストを除外できます | EMCではありません* | 「EMC」で始まらないものをすべて返します 


| _なし_ | すべてのフィールドでNULL値を検索します | _なし_ | 対象フィールドが空の場合の結果を返します 


| ない * | テキストのみのフィールドでNULL値を検索します | ない * | 対象フィールドが空の場合の結果を返します 
|===
フィルタ文字列を二重引用符で囲むと、Insight は最初の引用符と最後の引用符の間のすべてを完全一致として扱います。引用符内の特殊文字または演算子はリテラルとして扱われます。たとえば、「*」でフィルタリングすると、文字通りのアスタリスクである結果が返されます。この場合、アスタリスクはワイルドカードとして扱われません。演算子 OR と NOT も、二重引用符で囲むとリテラル文字列として扱われます。



=== ブール値のフィルタリング

ブール値をフィルタリングする場合、フィルタリングする次の選択肢が表示されることがあります。

* *任意*: 「はい」、「いいえ」に設定された結果、またはまったく設定されていない結果を含む、すべての結果が返されます。
* *はい*: 「はい」の結果のみを返します。DII では、ほとんどの表で「はい」にチェックマークが表示されることに注意してください。値は「True」、「On」などに設定できます。DII はこれらすべてを「Yes」として扱います。
* *いいえ*: 「いいえ」の結果のみを返します。DII では、ほとんどの表で「いいえ」が「X」として表示されることに注意してください。値は「False」、「Off」などに設定できますが、DII はこれらすべてを「No」として扱います。
* *なし*: 値がまったく設定されていない結果のみを返します。「Null」値とも呼ばれます。




== クエリ結果が得られたので、次に何をすればよいですか?

クエリを実行すると、簡単に注釈を追加したり、アセットにアプリケーションを割り当てたりできるようになります。アプリケーションまたは注釈は、インベントリ資産 (ディスク、ストレージなど) にのみ割り当てることができることに注意してください。統合メトリックは、注釈やアプリケーションの割り当てを行うことはできません。

クエリの結果のアセットに注釈またはアプリケーションを割り当てるには、結果テーブルの左側にあるチェックボックス列を使用してアセットを選択し、右側の*一括アクション*ボタンをクリックするだけです。選択したアセットに適用する目的のアクションを選択します。

image:QueryVolumeBulkActions.png["クエリ一括アクションの例"]



== 注釈ルールにはクエリが必要

設定する場合link:task_create_annotation_rules.html["アノテーション ルール"]各ルールには、操作対象となる基礎クエリが必要です。しかし、上で見たように、クエリは必要に応じて広くしたり狭くしたりすることができます。
