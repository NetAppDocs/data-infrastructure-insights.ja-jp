---
sidebar: sidebar 
permalink: task_create_query.html 
summary: クエリを使用すると、対象の資産や指標をすばやく簡単に識別できます。 
keywords: query, queries 
---
= クエリの作成
:hardbreaks:
:allow-uri-read: 


[role="lead"]
クエリを使用すると、テナントのアセットをきめ細かく検索して、必要なデータをフィルタリングし、結果を好みに合わせてソートできます。

たとえば、 _VOLUMES _ のクエリを作成し、選択したボリュームに関連付けられている特定の _クエリ を検索するフィルタを追加し、選択したボリュームで「 Tier 1 」などの特定の _annotation_associated を検索するフィルタをもう 1 つ追加できます。 最後に、 _iops-Read （ IO/s ） _greater が 25 を超えるすべてのストレージを検索するフィルタを追加します。結果が表示されたら、クエリに関連付けられている各列で情報を昇順または降順にソートすることができます。

注：アセットを取得する新しいデータコレクタが追加された場合、またはアノテーションやアプリケーションの割り当てが行われた場合は、クエリにインデックスが付けられたあとに初めて、それらの新しいアセット、アノテーション、またはアプリケーションを照会できます。インデックス作成は、定期的にスケジュールされた間隔で、またはアノテーションルールの実行などの特定のイベント中に実行されます。

.クエリの作成は非常に簡単です。
. [ クエリ ] 、 [ * + 新しいクエリ * ] の順に移動します。
. [ 選択 ...] リストから、照会するオブジェクトタイプを選択する。リストをスクロールしたり、入力を開始して検索対象をすばやく見つけることができます。


.スクロールリスト：
image:QueryDrop-DownList.png["クエリードロップダウン"]

.検索タイプ：
image:QueryPageFilter.png["検索する文字列を入力します"]

フィルタを追加して、 [* フィルタ条件 * ] フィールドの [*+*] ボタンをクリックすると、クエリをさらに絞り込むことができます。行をオブジェクトまたは属性でグループ化します。統合データ（ Kubernetes 、 ONTAP Advanced Metrics など）を使用する場合は、必要に応じて複数の属性でグループ化できます。

image:QueryFilterExample.png["クエリのフィルタリングとグループ化"]

クエリ結果リストには、検索対象のオブジェクトタイプに応じていくつかのデフォルト列が表示されます。列を追加、削除、または変更するには、テーブルの右側にある歯車アイコンをクリックします。使用可能な列は、アセット / 指標タイプによって異なります。

image:QuerySelectColumns.png["列を選択します"]



== 実際に動作を見てみましょう

link:https://media.netapp.com/video-detail/d0530e0b-a222-52e7-92b1-dbeeee41b712/explore-and-analyze-with-queries-in-data-infrastructure-insights["Data Infrastructure Insights のクエリを使用して探索および分析する (ビデオ)"]



== [集計]、[単位]、[条件付き書式]の順に選択します



=== 集計と単位

「値」列では、表示される値の集計方法を選択したり、それらの値を表示する単位を選択したりすることで、クエリ結果をさらに絞り込むことができます。これらのオプションは、列の上部にある「3つのドット」メニューを選択すると表示されます。

image:Query_Page_Aggregation_etc.png["[クエリ]ページの結果には、集計、条件付き書式、単位表示、列名の変更が表示されます"]



==== 単位

値を表示する単位を選択できます。たとえば、[Selected]列にraw容量が表示され、値の単位がGiBで表示されている場合は、[Unit Display]ドロップダウンから[TiB]を選択します。



==== 集約

同様に、表示されている値が基になるデータから「Average」として集約されている場合、 ただし、すべての値の合計を表示する場合は、_Group by_drop（グループ化された値に合計を表示する場合）または_Time Aggregate by_drop（行の値に基礎となるデータの合計を表示する場合）から[Sum]を選択します。

グループ化されたデータポイントを_Avg、Max、Min、またはSum_で集計することができます。

個 々 の行データは、_Average、Last data point Acquired、Maximum、Minimum、またはSum_で集計できます。



==== 条件付き書式

条件付き書式を使用すると、クエリ結果リストで警告レベルと重要レベルのしきい値を強調表示し、外れ値や例外的なデータポイントを即座に可視化できます。

image:Query_Page_Conditional_Formatting.png["クエリページの条件付き書式"]

条件付き書式は、列ごとに個別に設定されます。たとえば、容量列ではしきい値のセットを選択し、スループット列ではしきい値のセットを選択できます。



==== 列名を変更します

列の名前を変更すると、[クエリ結果]リストに表示される名前が変更されます。クエリリストを.csvにエクスポートすると、新しい列名も結果のファイルに表示されます。



=== 保存

目的の結果が表示されるようにクエリを設定したら、 * 保存 * ボタンをクリックして、クエリを保存して後で使用することができます。わかりやすい一意の名前を指定してください。



== フィルタリングの詳細



=== ワイルドカードと式

クエリやダッシュボードウィジェットでテキストやリストの値をフィルタする場合、入力を開始すると、現在のテキストに基づいて * ワイルドカードフィルタ * を作成するオプションが表示されます。このオプションを選択すると、ワイルドカード式に一致するすべての結果が返されます。NOTまたはORを使用して*式*を作成することもできます。また、「なし」オプションを選択してフィールド内のnull値をフィルタリングすることもできます。

image:Type-Ahead-Example-ingest.png["ワイルドカードフィルタ"]

ワイルドカードまたは式に基づくフィルタ（例 フィルタフィールドに濃い青で表示されます。リストから直接選択した項目は、水色で表示されます。

image:Type-Ahead-Example-Wildcard-DirectSelect.png["ワイルドカードフィルタの結果"]

ワイルドカードおよび式フィルタリングは、テキストまたはリストでは機能しますが、数値、日付、またはブール値では機能しません。



=== フィルタの調整

次の方法でフィルタを絞り込むことができます。

|===


| フィルタ | 機能 | 例 | 結果 


| * （アスタリスク） | すべての項目を検索できます | ボリューム * RHEL | 「 vol 」で始まるリソースをすべて返し、「 rhel 」で終わるリソースをすべて返します。 


| ? （疑問符） | では、特定の数の文字を検索できます | BOS-PRD ？？ -S12 | BOS-PRD **_12_**-S12 、 BOS-PRD **_23_**-S12 などを返します 


| または | 複数のエンティティを指定できます | FAS2240 または CX600 または FAS3270 | FAS2440 、 CX600 、または FAS3270 のいずれかを返します 


| ありません | 検索結果からテキストを除外できます | EMC * ではありません | 「 EMC 」で始まるものをすべて返します。 


| _ なし _ | すべてのフィールドで NULL 値を検索します | _ なし _ | ターゲットフィールドが空の場合に結果を返します 


| NOT * | _text-only_fields 内の NULL 値を検索します | NOT * | ターゲットフィールドが空の場合に結果を返します 
|===
フィルタ文字列を二重引用符で囲むと、 Insight では、最初と最後の引用符の間のすべての部分が完全に一致するものとして扱われます。引用符内の特殊文字または演算子は、リテラルとして扱われます。たとえば、「 * 」を指定した場合、リテラルアスタリスクである結果は返されますが、アスタリスクはワイルドカードとして扱われません。演算子 OR および NOT は、二重引用符で囲まれた場合にもリテラル文字列として扱われます。



== クエリ結果が表示されたら、どうすればよいですか？

クエリを使用すると、アノテーションの追加やアセットへのアプリケーションの割り当てを簡単に行うことができます。インベントリアセットに割り当てることができるのは、アプリケーションやアノテーションだけです（ディスク、ストレージなど）。統合指標には、アノテーションやアプリケーションの割り当ては適用されません。

照会結果のアセットに注釈またはアプリケーションを割り当てるには、結果テーブルの左側にあるチェックボックス列を使用してアセットを選択し、右側の * 一括アクション * ボタンをクリックします。選択したアセットに適用するアクションを選択します。

image:QueryVolumeBulkActions.png["一括アクションの照会の例"]



== アノテーションルールではクエリが必要です

を設定する場合link:task_create_annotation_rules.html["アノテーションルール"]は、各ルールで使用するクエリが必要です。しかし、前述のように、クエリは必要に応じて広範囲に、または限定されています。
