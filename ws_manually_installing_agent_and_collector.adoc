---
sidebar: sidebar 
permalink: ws_manually_installing_agent_and_collector.html 
keywords: install, configure, agent, collector, workload, security, cloud secure 
summary: Workload Security エージェントは手動でインストールまたは更新できるため、テナントにインストールされたソフトウェアをより細かく制御できます。 
---
= Workload Security エージェントとコレクターの手動インストール
:hardbreaks:
:allow-uri-read: 


[role="lead"]
デフォルトでは、Workload Security エージェントまたはコレクターの新しいバージョンが利用可能になると、アップグレード前の通知が送信され、テナント上でエージェントとコレクターが自動的に更新されます。ただし、セキュリティで保護された制御された環境では、自動アップグレードは望ましくない場合があります。このような場合、Workload Security を設定してエージェントとコレクターを手動でインストール/アップグレードすることで、システムにインストールされているソフトウェアをより細かく制御できるようになります。



== 開始前の準備

. Swagger で、「cloudsecure_installers.agent」および「cloudsecure_installers.collector」という名前の API カテゴリが使用可能であることを確認します。そうでない場合、エージェントの手動インストールのサポートは有効になりません。この機能を有効にするには、 NetAppサポートにお問い合わせください。
+
image:ws_manual_install_APIs.png["手動インストールAPI"]

. このドキュメントに記載されているすべてのコマンドを「root」ユーザーとして実行するか、別のユーザーで実行する場合は「sudo」を使用してコマンドを実行します。




== 新しいエージェントのインストール

. 新しい Workload Security API アクセス トークンを作成します。
+
.. *管理 > API アクセス* に移動します。  「ワークロード セキュリティ トークン」タブを選択し、「+ API アクセス トークン」をクリックします。
+
... 識別しやすい名前と説明を設定します。
... 「このトークンはどのタイプの API を呼び出すために使用されますか?」ドロップダウンで、_Collector Management_ と _Agent & Collector Installation_ を選択します。
... 希望する有効期限を選択します。


.. [_保存_]をクリックします。




[[copy-access-token]]
. 生成された API アクセス トークンをコピーします。ウィンドウを閉じるとトークンを取得できなくなることに注意してください。その場合、新しいトークンを生成する必要があります。
+
image:ws_create_and_save_token.png["APIトークンを作成して保存する"]

+
image:ws_create_and_save_token_confirm.png["トークンの作成を確認する"]

+
.. *管理 > API アクセス > API ドキュメント* (ページの右上) に移動し、_Workload Security_ アイコンを選択します。これにより、Workload Security API の Swagger ドキュメントが開きます。
+
image:ws_swagger_documentation_link.png["ワークロード セキュリティの Swagger ドキュメント"]

.. _Workload Security_ API へのアクセスを承認します。


. ページの右上にある [_承認_] ボタンをクリックします。
. _Customer ApiKey (apiKey)_テキストフィールドに、先ほどコピーしたAPIトークンを貼り付けます。<<copy-access-token,ステップ1c>> 。
. 「承認」をクリックしてウィンドウを閉じます。
+
image:ws_API_authorization.png["APIを承認する"]

+
.. エージェントのインストーラーをダウンロードします。


. Swagger で、_cloudsecure_installers.agent_ > _/v1/cloudsecure/agents/installers/{platform}/latest_ (GET) API を選択します。  「試してみる」をクリックします。
. _platform_ フィールドに「_linux_」と入力します。  _実行_をクリックします。
+
image:ws_installers_agent_api_swagger.png["エージェントインストーラー API の Swagger - トップ"] image:ws_installers_agent_api_swagger-2.png["エージェントインストーラーAPIのSwagger - レスポンス"]

. 「ファイルのダウンロード」をクリックしてインストーラーをダウンロードします。
. インストーラ ファイルが、エージェントがインストールされるシステムとは別のマシンに外部的にダウンロードされた場合は、インストーラ ファイルをそのシステムにコピーします。
. あるいは、curl コマンドをコピーして、エージェントをインストールするシステムで直接実行することもできます。
+
** インストーラー ファイルを任意の名前で保存するには、curl コマンドに「-o {{file_name}}」引数を追加します。インストーラー ファイルの実際の名前は、Swagger 応答ヘッダー セクションにあります。その名前も使用される可能性があります。
+
image:ws_installers_agent_api_swagger_installer_file.png["API経由で最新のエージェントを選択する - Swagger"]

** ファイルは任意の場所にダウンロードできますが、インストーラー .zip を抽出できる空のフォルダーにダウンロードすることをお勧めします。
+
... 新しいフォルダーを作成し (推奨)、インストーラー ファイルをこのフォルダーにコピーして解凍します。
+
[listing]
----
[root@demo-agent /]# mkdir agent_installers
[root@demo-agent /]# cd agent_installers/
[root@demo-agent agent_installers]# pwd
/agent_installers
[root@demo-agent agent_installers]# ll
total 0
[root@demo-agent agent_installers]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/agents/installers/linux/latest" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cloudsecure-linux-agent-installer-1.617.0.zip
[root@demo-agent agent_installers]# ll
total 76012
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip
----
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.617.0.zip
Archive:  cloudsecure-linux-agent-installer-1.617.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
----
... 「cloudsecure-agent-install.sh」ファイルに _execute_ 権限を設定します。
+
[listing]
----
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-install.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154250 Apr 26 06:37 cloudsecure-agent-image.zip
-rwx------ 1 root root    16574 Apr 26 06:25 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26 06:25 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip

----
... 新しいエージェントのインストール用にワンタイム トークンを生成します。
+
注: この手順で生成されるワンタイムトークンは、<<copy-access-token,ステップ1c>> 。





. Swagger で、_cloudsecure_installers.agent > /v1/cloudsecure/agent/oneTimeToken_ API を実行し、応答からトークンをコピーします。
+
.. ワンタイム トークンを環境変数としてエクスポートします。
+
[listing]
----
[root@demo-agent ~]# export TOKEN=<<one time token generated in step 7>>
----
.. プロキシ サーバーを使用する場合は、以下の形式で https_proxy を環境変数としてエクスポートします。
+
[listing]
----
[root@demo-agent ~]# export HTTPS_PROXY='USER:PASSWORD@PROXY_SERVER:PORT'
----
.. オプション: デフォルトでは、エージェントとコレクターはパス「/opt/netapp」にインストールされます。別のパスにインストールするには、次の環境変数を設定します。
+
[listing]
----
[root@demo-agent ~]# export AGENT_INSTALL_PATH=/test_user/apps
----
+
注: カスタム パスにインストールした場合、データ コレクターとエージェント ログなどのその他のすべてのアーティファクトは、カスタム パス内にのみ作成されます。インストール ログは、_/var/log/netapp/cloudsecure/install_ に残ります。

.. エージェントインストーラーをダウンロードしたディレクトリに戻り、「cloudsecure-agent-install.sh」を実行します。
+
[listing]
----
[root@demo-agent agent_installers]# ./ cloudsecure-agent-install.sh
----
+
注意: ユーザーが「bash」シェルで実行していない場合、エクスポート コマンドは機能しない可能性があります。その場合、手順 8 から 11 を組み合わせて以下のように実行できます。  HTTPS_PROXY と AGENT_INSTALL_PATH はオプションであり、必要ない場合は無視できます。

+
[listing]
----
sudo /bin/bash -c "TOKEN=<<one time token generated in step 7>> HTTPS_PROXY=<<proxy details in the format mentioned in step 9>> AGENT_INSTALL_PATH=<<custom_path_to_install_agent>> ./cloudsecure-agent-install.sh"
----
+
この時点で、エージェントは正常にインストールされるはずです。

.. エージェントのインストールの健全性チェック:


. 「systemctl status cloudsecure-agent.service」を実行し、エージェント サービスが _running_ 状態であることを確認します。
+
[listing]
----
[root@demo-agent ~]# systemctl status cloudsecure-agent.service
 cloudsecure-agent.service - Cloud Secure Agent Daemon Service
   Loaded: loaded (/usr/lib/systemd/system/cloudsecure-agent.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2024-04-26 02:50:37 EDT; 12h ago
 Main PID: 15887 (java)
    Tasks: 72
   CGroup: /system.slice/cloudsecure-agent.service
           ├─15887 java -Dconfig.file=/test_user/apps/cloudsecure/agent/conf/application.conf -Dagent.proxy.host= -Dagent.proxy.port= -Dagent.proxy.user= -Dagent.proxy.password= -Dagent.env=prod -Dagent.base.path=/test_user/apps/cloudsecure/agent -...

----
. エージェントは「エージェント」ページに表示され、「接続済み」状態になっている必要があります。
+
image:ws_agentsPageShowingConnected.png["接続されたエージェントを表示するUI"]

+
.. インストール後のクリーンアップ。


. エージェントのインストールが成功した場合は、ダウンロードしたエージェント インストーラー ファイルを削除できます。




== 新しいデータコレクターをインストールしています。

注: このドキュメントには、「ONTAP SVM データ コレクター」のインストール手順が記載されています。  「Cloud Volumes ONTAPデータコレクター」と「Amazon FSx for NetApp ONTAPデータコレクター」にも同じ手順が適用されます。

. コレクターをインストールする必要があるシステムに移動し、_agent installation path_ ディレクトリの下に _./tmp/collectors_ という名前のディレクトリを作成します。
+
注: エージェントが _/opt/netapp_ にインストールされている場合は、_/opt/netapp/cloudsecure_ に移動します。

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. _tmp_ ディレクトリの所有権を *cssys:cssys* に再帰的に変更します (cssys ユーザーとグループはエージェントのインストール中に作成されます)。
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. ここで、コレクターのバージョンとコレクターの UUID を取得する必要があります。  「cloudsecure_config.collector-types」API に移動します。
. Swagger の「cloudsecure_config.collector-types > /v1/cloudsecure/collector-types」(GET) API に移動します。 「collectorCategory」ドロップダウンで、コレクター タイプとして「DATA」を選択します。すべてのコレクター タイプの詳細を取得するには、「すべて」を選択します。
. 必要なコレクター タイプの UUID をコピーします。
+
image:ws_collectorAPIShowingUUID.png["UUID を表示するコレクター API 応答"]

. コレクターインストーラーをダウンロードします。
+
.. 「cloudsecure_installers.collector > /v1/cloudsecure/collector-types/installers/{collectorTypeUUID}」(GET) API に移動します。前の手順でコピーした UUID を入力し、インストーラー ファイルをダウンロードします。
+
image:ws_downloadCollectorByUUID.png["UUIDでコレクターをダウンロードするためのAPI"]

.. インストーラ ファイルを別のマシンに外部的にダウンロードした場合は、エージェントが実行されているシステムにインストーラ ファイルをコピーし、ディレクトリ _/{agent-install-path}/cloudsecure/tmp/collectors_ に配置します。
.. あるいは、同じ API から curl コマンドをコピーし、コレクターをインストールするシステムで直接実行することもできます。
+
ファイル名は、ダウンロード コレクター API の応答ヘッダーにあるものと同じである必要があります。下のスクリーンショットを参照してください。

+
注: エージェントが _/opt/netapp_ にインストールされている場合は、_/opt/netapp/cloudsecure/tmp/collectors_ に移動します。

+
image:ws_curl_command.png["難読化されたトークンを表示するCurlコマンドの例"]

+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/1829df8a-c16d-45b1-b72a-ed5707129870" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ontap-dsc_1.286.0.zip
----


. コレクター インストーラー zip ファイルの所有権を *cssys:cssys* に変更します。
+
[listing]
----
-rw------- 1 root root 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# ll
total 49716
-rw------- 1 cssys cssys 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
----
. *Workload Security > Collectors* に移動し、*+Collector* を選択します。  _ONTAP SVM_ コレクターを選択します。
. コレクターの詳細を設定し、コレクターを _保存_ します。
. [_保存_] をクリックすると、エージェント プロセスは _/{agent-install-path}/cloudsecure/tmp/collectors/_ ディレクトリからコレクター インストーラーを検索し、コレクターをインストールします。
. 代替オプションとして、UI 経由でコレクターを追加する代わりに、API 経由でも追加できます。
+
.. 「cloudsecure_config.collectors」>「/v1/cloudsecure/collectors」(POST) API に移動します。
.. 例のドロップダウンで、「ONTAP SVM データ コレクター json サンプル」を選択し、コレクター構成の詳細を更新して実行します。
+
image:ws_API_add_collector.png["コレクターを追加するためのAPI"]



. コレクターは「データ コレクター」セクションの下に表示されるようになります。
+
image:ws_collectorPageList.png["コレクターを表示するUIリストページ"]

. インストール後のクリーンアップ。
+
.. コレクターのインストールが成功した場合は、ディレクトリ _/{agent-install-path}/cloudsecure/tmp/collectors_ 内のすべてのファイルを削除できます。






== 新しいユーザーディレクトリコレクターのインストール

注: このドキュメントでは、LDAP コレクターをインストールする手順について説明しました。  AD コレクターのインストールにも同じ手順が適用されます。

. 1.コレクターをインストールする必要があるシステムに移動し、_agent installation path_ ディレクトリの下に _./tmp/collectors_ という名前のディレクトリを作成します。
+
注: エージェントが _/opt/netapp_ にインストールされている場合は、_/opt/netapp/cloudsecure_ に移動します。

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
+
.. _collectors_ ディレクトリの所有権を *cssys:cssys* に変更します。
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp

[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors

----


. ここで、コレクターのバージョンと UUID を取得する必要があります。 「cloudsecure_config.collector-types」API に移動します。コレクターカテゴリドロップダウンで、コレクタータイプとして「ユーザー」を選択します。  1 回のリクエストですべてのコレクター タイプの詳細を取得するには、「すべて」を選択します。
+
image:ws_API_collector_all.png["すべてのコレクターを取得するためのAPI"]

. LDAP コレクターの UUID をコピーします。
+
image:ws_LDAP_collector_UUID.png["LDAPコレクターUUIDを示すAPIレスポンス"]

. コレクターインストーラーをダウンロードします。
+
.. 「cloudsecure_installers.collector」>「/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}」(GET) API に移動します。前の手順でコピーした UUID を入力し、インストーラー ファイルをダウンロードします。
+
image:ws_LDAP_collector_UUID_download.png["ダウンロードコレクターへのAPIと応答"]

.. インストーラ ファイルを別のマシンの外部にダウンロードした場合は、エージェントが実行されているシステムのディレクトリ _/{agent-installation-path}/cloudsecure/tmp/collectors_ にインストーラ ファイルをコピーします。
.. あるいは、同じ API から curl コマンドをコピーし、コレクターをインストールするシステムで直接実行することもできます。
+
ファイル名は、ダウンロード コレクター API の応答ヘッダーにあるものと同じである必要があります。下のスクリーンショットを参照してください。

+
また、エージェントが _/opt/netapp_ にインストールされている場合は、_/opt/netapp/cloudsecure/tmp/collectors_ に移動することにも注意してください。

+
image:ws_curl_command.png["Curl コマンド API"]



+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/37fb37bd-6078-4c75-a64f-2b14cb1a1eb1" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ldap-dsc_1.322.0.zip
----
. コレクター インストーラー zip ファイルの所有権を cssys:cssys に変更します。
+
[listing]
----
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 root root 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 cssys cssys 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip

----
. 「ユーザー ディレクトリ コレクター」ページに移動し、「+ ユーザー ディレクトリ コレクター」をクリックします。
+
image:ws_user_directory_collector.png["ユーザーディレクトリコレクターの追加"]

. 「LDAP ディレクトリ サーバー」を選択します。
+
image:ws_LDAP_user_select.png["LDAPユーザーを選択するためのUIウィンドウ"]

. LDAPディレクトリサーバーの詳細を入力し、「保存」をクリックします。
+
image:ws_LDAP_user_Details.png["LDAP ユーザーの詳細を表示する UI"]

. [_Save_] をクリックすると、エージェント サービスは _/{agent-install-path}/cloudsecure/tmp/collectors/_ ディレクトリからコレクター インストーラーを検索し、コレクターをインストールします。
. 代替オプションとして、UI 経由でコレクターを追加する代わりに、API 経由でも追加できます。
+
.. 「cloudsecure_config.collectors」>「/v1/cloudsecure/collectors」(POST) API に移動します。
.. 例のドロップダウンで、「LDAP ディレクトリ サーバー ユーザー コレクター json サンプル」を選択し、コレクター構成の詳細を更新して、「実行」をクリックします。
+
image:ws_API_LDAP_Collector.png["LDAPコレクター用のAPI"]



. コレクターは、「ユーザー ディレクトリ コレクター」セクションの下に表示されるようになります。
+
image:ws_LDAP_collector_list.png["UI の LDAP コレクター リスト"]

. インストール後のクリーンアップ。
+
.. コレクターのインストールが成功した場合は、ディレクトリ _/{agent-install-path}/cloudsecure/tmp/collectors_ 内のすべてのファイルを削除できます。






== エージェントのアップグレード

エージェント/コレクターの新しいバージョンが利用可能になると、電子メール通知が送信されます。

. 最新のエージェントインストーラーをダウンロードしてください。
+
.. 最新のインストーラーをダウンロードする手順は、「新しいエージェントのインストール」の手順と同様です。 Swagger で、「cloudsecure_installers.agent」>「/v1/cloudsecure/agents/installers/{platform}/latest」API を選択し、プラットフォームに「linux」と入力して、インストーラーの zip ファイルをダウンロードします。代わりに、curl コマンドを使用することもできます。インストーラー ファイルを解凍します。


. 「cloudsecure-agent-upgrade.sh」ファイルの実行権限を設定します。
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.618.0.zip
Archive:  cloudsecure-linux-agent-installer-1.618.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rwx------ 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip

----
. 「cloudsecure-agent-upgrade.sh」スクリプトを実行します。スクリプトが正常に実行された場合、出力に「Cloudsecure エージェントが正常にアップグレードされました。」というメッセージが表示されます。
. 次のコマンド「systemctl daemon-reload」を実行します。
+
[listing]
----
[root@demo-agent ~]# systemctl daemon-reload
----
. エージェント サービスを再起動します。
+
[listing]
----
[root@demo-agent ~]# systemctl restart cloudsecure-agent.service
----
+
この時点で、エージェントは正常にアップグレードされるはずです。

. エージェントのアップグレード後の健全性チェック。
+
.. エージェントがインストールされているパス (例: "/opt/netapp/cloudsecure/") に移動します。シンボリックリンク「agent」は、エージェントの新しいバージョンを指す必要があります。
+
[listing]
----
[root@demo-agent cloudsecure]# pwd
/opt/netapp/cloudsecure
[root@demo-agent cloudsecure]# ll
total 40
lrwxrwxrwx  1 cssys cssys  114 Apr 26 17:38 agent -> /test_user/apps/cloudsecure/cloudsecure-agent-1.618.0
drwxr-xr-x  4 cssys cssys 4096 Apr 25 10:45 agent-certs
drwx------  2 cssys cssys 4096 Apr 25 16:18 agent-logs
drwx------ 11 cssys cssys 4096 Apr 26 02:50 cloudsecure-agent-1.617.0
drwx------ 11 cssys cssys 4096 Apr 26 17:42 cloudsecure-agent-1.618.0
drwxr-xr-x  3 cssys cssys 4096 Apr 26 02:45 collector-image
drwx------  2 cssys cssys 4096 Apr 25 10:45 conf
drwx------  3 cssys cssys 4096 Apr 26 16:39 data-collectors
-rw-r--r--  1 root  root    66 Apr 25 10:45 sysctl.conf.bkp
drwx------  2 root  root  4096 Apr 26 17:38 tmp

----
.. エージェントは「エージェント」ページに表示され、「接続済み」状態になっている必要があります。
+
image:ws_agentsPageShowingConnected.png["接続されたエージェントを表示するUI"]



. インストール後のクリーンアップ。
+
.. エージェントのインストールが成功した場合は、ダウンロードしたエージェント インストーラー ファイルを削除できます。






== コレクターのアップグレード

注: アップグレード手順は、すべてのタイプのコレクターで同じです。このドキュメントでは、「ONTAP SVM」コレクターのアップグレードについて説明します。

. コレクターをアップグレードする必要があるシステムに移動し、_agent installation path_ ディレクトリの下に _./tmp/collectors_ ディレクトリがまだ存在しない場合は作成します。
+
注: エージェントが _/opt/netapp_ にインストールされている場合は、_/opt/netapp/cloudsecure_ ディレクトリに移動します。

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. ディレクトリ「collectors」が _cssys:cssys_ によって所有されていることを確認してください。
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. Swagger で、「cloudsecure_config.collector-types」GET API に移動します。  「collectorCategory」ドロップダウンで、「DATA」を選択します（ユーザー ディレクトリ コレクターの場合は「USER」、そうでない場合は「ALL」を選択します）。
+
レスポンス本文から UUID とバージョンをコピーします。

+
image:ws_collector_uuid_and_version.png["コレクター UUID とバージョンが強調表示された API 応答"]

. 最新のコレクターインストーラーファイルをダウンロードします。
+
.. _cloudsecure_installers.collector_ > _/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}_ API に移動します。前の手順でコピーした _collectorTypeUUID_ を入力します。インストーラーを _/{agent-install-path}/cloudsecure/tmp/collectors_ ディレクトリにダウンロードします。
.. あるいは、同じ API の curl コマンドも使用できます。
+
image:ws_curl_command_only.png["Curlコマンドの例"]

+
注: ファイル名は、ダウンロード コレクター API の応答ヘッダーにあるものと同じである必要があります。



. コレクター インストーラー zip ファイルの所有権を cssys:cssys に変更します。
+
[listing]
----
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 root root 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 cssys cssys 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip

----
. アップグレード コレクター API をトリガーします。
+
.. Swagger で、「cloudsecure_installers.collector」>「/v1/cloudsecure/collector-types/upgrade」(PUT) API に移動します。
.. 「例」ドロップダウンで、「ONTAP SVM データ コレクター アップグレード json サンプル」を選択して、サンプル ペイロードを入力します。
.. バージョンをコピー元のバージョンに置き換える<<copy-access-token,ステップ3>>「実行」をクリックします。
+
image:ws_svm_ontap_collector_upgrade_example_json.png["Swagger UI での SVM アップグレードの例"]

+
数秒お待ちください。コレクターは自動的にアップグレードされます。



. 健全性チェック。
+
コレクターは UI で実行状態になっている必要があります。

. アップグレード後のクリーンアップ:
+
.. コレクターのアップグレードが成功した場合は、ディレクトリ _/{agent-install-path}/cloudsecure/tmp/collectors_ 内のすべてのファイルを削除できます。




他のタイプのコレクターをアップグレードする場合も、上記の手順を繰り返します。



== Commons の問題と修正。

. AGENT014 エラー
+
このエラーは、コレクター インストーラー ファイルが _/{agent-install-path}/cloudsecure/tmp/collectors_ ディレクトリに存在しないか、アクセスできない場合に発生します。インストーラ ファイルがダウンロードされ、_collectors_ の完全なディレクトリ構造とインストーラ zip ファイルが cssys:cssys によって所有されていることを確認してから、エージェント サービスを再起動します: _systemctl restart cloudsecure-agent.service_。

+
image:ws_agent014_error.png["「エージェント 014」エラーのホバーヒントが表示された UI 画面"]

. 不正なエラー
+
[listing]
----
{
  "errorMessage": "Requested public API is not allowed to be accessed by input API access token.",
  "errorCode": "NOT_AUTHORIZED"
}

----
+
必要な API カテゴリをすべて選択せずに API アクセス トークンが生成されると、このエラーが表示されます。必要なすべての API カテゴリを選択して、新しい API アクセス トークンを生成します。


